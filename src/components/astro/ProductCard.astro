---
// src/components/astro/ProductCard.astro
import { whatsappMessage } from '@/utils/whatsappMessage';

export interface Props {
  product: {
    id: string;
    name: string;
    shortDescription?: string;
    image: { href: string; dataThumb?: string };
    category_1_text?: string;
    price?: string; // optional: show price if you have it
    isNew?: boolean; // optional: for NEW badge
  };
}
const { product } = Astro.props;

// Use thumbnail if available (faster), fallback to main image
const imgSrc =  product.image.href;
---

<article class="group flex flex-col h-full bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden">
  <!-- Image Container -->
  <div class="relative aspect-square bg-gray-50 overflow-hidden">
    <a href={`/products/${product.id}`} class="block w-full h-full">
      <img
        src={imgSrc}
        alt={product.name}
        loading="lazy"
        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
      />
    </a>

    <!-- NEW Badge -->
    {product.isNew && (
      <span class="absolute top-3 left-3 z-10 bg-emerald-600 text-white text-xs font-bold px-3 py-1.5 rounded-full shadow-lg">
        NEW
      </span>
    )}

    <!-- Category Tag -->
    {product.category_1_text && (
      <span class="absolute bottom-3 left-3 z-10 bg-white/90 backdrop-blur-sm text-emerald-700 text-xs font-semibold px-3 py-1.5 rounded-full shadow">
        {product.category_1_text}
      </span>
    )}
  </div>

  <!-- Card Body -->
  <div class="flex flex-col flex-1 p-5 gap-3">
    <!-- Title -->
    <h3 class="font-semibold text-gray-900 text-base line-clamp-2 leading-tight group-hover:text-emerald-600 transition-colors">
    
        {product.name}
    
    </h3>

    <!-- CTA Buttons -->
    <div class="flex flex-col gap-3 mt-auto pt-2">
      <a
        href={`/products/${product.id}`}
        class="text-left text-emerald-600 hover:text-emerald-700 font-medium text-sm underline-offset-4 hover:underline transition"
      >
        View Details â†’
      </a>

      <a
        href={`https://wa.me/971501234567?text=${whatsappMessage(product)}`}
        target="_blank"
        rel="noopener"
        class="btn-whatsapp w-full py-3 text-center text-white font-semibold rounded-xl shadow-md hover:shadow-lg transition-all"
      >
        Get Price on WhatsApp
      </a>
    </div>
  </div>
</article>

<style>
  /* Full-card clickable area */
  article {
    position: relative;
    display: flex;
    flex-direction: column;
  }

  /* WhatsApp button style (you probably have this in global.css, but safe fallback) */
  .btn-whatsapp {
    background: linear-gradient(135deg, #25d366, #128c7e);
  }
  .btn-whatsapp:hover {
    background: linear-gradient(135deg, #128c7e, #075e54);
  }
</style>