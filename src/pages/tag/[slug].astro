---
import Layout from '../../../components/layouts/Layout.astro';
import ProductCard from '../../../components/astro/ProductCard.astro';
import { getUniqueTags } from '@/utils/getUniqueTags';
import { slugify } from '@/utils/slugify';
import { filterByTag } from '@/utils/filterByTag';
import products from '@/data/products.json';

export async function getStaticPaths() {
  const tags = await getUniqueTags();
  return tags.map(t => ({
    params: { slug: slugify(t) },
    props: { tagName: t }
  }));
}

const { slug } = Astro.params;
const { tagName } = Astro.props;
const list = filterByTag(products, slug);

const title = `${tagName} Products | Eliphany`;
const description = `Explore products tagged ${tagName} – order via WhatsApp.`;
---

<Layout {title} {description}>
  <section class="py-12 px-4 max-w-7xl mx-auto">
    <nav class="text-sm text-gray-500 mb-4">
      <a href="/" class="hover:underline">Home</a>
      <span class="mx-2">/</span>
      <span class="text-gray-900">{tagName}</span>
    </nav>

    <h1 class="text-4xl font-bold text-gray-900 mb-2">{tagName}</h1>
    <p class="text-gray-600 mb-8">Products tagged under "{tagName}".</p>

    {list.length === 0 ? (
      <p class="text-gray-600">No products match this tag yet – check back soon!</p>
    ) : (
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        {list.map(p => <ProductCard product={p} />)}
      </div>
    )}
  </section>
</Layout>